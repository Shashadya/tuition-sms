{% extends 'academic_core/base.html' %}
{% block title %}Teacher Detail{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-3">
    {% if teacher.profile_photo %}
      <img src="{{ teacher.profile_photo.url }}" class="img-fluid rounded" alt="Teacher photo">
    {% else %}
      <div class="bg-secondary text-white text-center p-4">No photo</div>
    {% endif %}
  </div>
  <div class="col-md-9">
    <h3>{{ teacher.title }} {{ teacher.first_name }} {{ teacher.last_name }}</h3>
    <p><strong>Email:</strong> {{ teacher.email|default:"—" }}</p>
    <p><strong>Phone:</strong> {{ teacher.phone|default:"—" }}</p>
    <p><strong>WhatsApp:</strong> {{ teacher.whatsapp|default:"—" }}</p>
    <p><strong>Date of birth:</strong> {{ teacher.dob|default:"—" }}</p>
    <p><strong>Active:</strong> {% if teacher.is_active %}Yes{% else %}No{% endif %}</p>

    <div class="mt-3">
      <a class="btn btn-outline-primary" href="{% url 'academic_core:teacher_list' %}">Back to list</a>
      {% if request.user.is_admin or request.user.is_staff_user %}
        <a class="btn btn-sm btn-secondary" href="{% url 'academic_core:teacher_update' teacher.pk %}">Edit</a>
      {% endif %}
      {% if request.user.is_admin %}
        <form method="post" action="{% url 'academic_core:teacher_delete' teacher.pk %}" style="display:inline" onsubmit="return confirm('Delete teacher {{ teacher }}?');">{% csrf_token %}
          <button class="btn btn-sm btn-danger">Delete</button>
        </form>
      {% endif %}
    </div>

    <hr>

    <h5>Current Assignments</h5>
    {% if assignments %}
      <table class="table table-sm">
        <thead>
          <tr><th>Assign ID</th><th>Subject</th><th>Start</th><th>End</th><th>Actions</th></tr>
        </thead>
        <tbody>
          {% for a in assignments %}
          <tr>
            <td>{{ a.assign_id }}</td>
            <td>{{ a.subject.name }} ({{ a.subject.subject_id }})</td>
            <td>{{ a.start_date }}</td>
            <td>{{ a.end_date|default:"—" }}</td>
            <td>
              {% if request.user.is_admin or request.user.is_staff_user %}
                <a class="btn btn-sm btn-outline-secondary" href="{% url 'academic_core:subjectassign_update' a.pk %}">Edit</a>
              {% endif %}
              {% if request.user.is_admin %}
                <form method="post" action="{% url 'academic_core:subjectassign_delete' a.pk %}" style="display:inline" onsubmit="return confirm('Delete assignment {{ a.assign_id }}?');">{% csrf_token %}
                  <button class="btn btn-sm btn-danger">Delete</button>
                </form>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p><em>No assignments for this teacher.</em></p>
    {% endif %}
  </div>
</div>
{% endblock %}
