<!-- academic_core/templates/academic_core/class_form.html -->
{% extends 'academic_core/base.html' %}
{% block title %}Create Class{% endblock %}

{% block content %}
<h3 class="mb-3">Create Class</h3>

<form method="post" enctype="multipart/form-data" novalidate>
  {% csrf_token %}

  <div class="row">
    <!-- LEFT COLUMN -->
    <div class="col-md-6">
      <!-- Class ID with previous hint -->
      <div class="mb-3">
        <label for="id_class_id" class="form-label">Class ID</label>
        <input
          type="text"
          name="class_id"
          id="id_class_id"
          class="form-control {% if form.class_id.errors %}is-invalid{% endif %}"
          value="{{ form.class_id.value|default:'' }}"
          placeholder="Enter new class ID (e.g., T001)"
        >
        {% if last_class_id %}
          <small class="text-muted">Previous Class ID: <strong>{{ last_class_id }}</strong></small>
        {% endif %}
        {% if form.class_id.errors %}
          <div class="invalid-feedback">{{ form.class_id.errors|join:", " }}</div>
        {% endif %}
      </div>

      <!-- Class Name -->
      <div class="mb-3">
        <label class="form-label">Class Name</label>
        {{ form.name }}
        {% if form.name.errors %}<div class="text-danger small">{{ form.name.errors }}</div>{% endif %}
      </div>

      <!-- Description -->
      <div class="mb-3">
        <label class="form-label">Description</label>
        {{ form.description }}
        {% if form.description.errors %}<div class="text-danger small">{{ form.description.errors }}</div>{% endif %}
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="col-md-6">
      <!-- Class Mode -->
      <div class="mb-3">
        <label class="form-label">Class Mode</label>
        {{ form.class_mode }}
        {% if form.class_mode.errors %}<div class="text-danger small">{{ form.class_mode.errors }}</div>{% endif %}
      </div>

      <!-- Fee Type -->
      <div class="mb-3">
        <label class="form-label">Fee Type</label>
        {{ form.fee_type }}
        {% if form.fee_type.errors %}<div class="text-danger small">{{ form.fee_type.errors }}</div>{% endif %}
      </div>

      <!-- Per session fee and Monthly fee -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Per-session Fee</label>
          {{ form.per_session_fee }}
          {% if form.per_session_fee.errors %}<div class="text-danger small">{{ form.per_session_fee.errors }}</div>{% endif %}
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Monthly Fee</label>
          {{ form.monthly_fee }}
          {% if form.monthly_fee.errors %}<div class="text-danger small">{{ form.monthly_fee.errors }}</div>{% endif %}
        </div>
      </div>

      <!-- Class Teacher -->
      <div class="mb-3">
        <label class="form-label">Class Teacher</label>
        {{ form.class_teacher }}
        {% if form.class_teacher.errors %}<div class="text-danger small">{{ form.class_teacher.errors }}</div>{% endif %}
      </div>

      <!-- Capacity & Active -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Capacity</label>
          {{ form.capacity }}
          {% if form.capacity.errors %}<div class="text-danger small">{{ form.capacity.errors }}</div>{% endif %}
        </div>
        <div class="col-md-6 mb-3 d-flex align-items-center">
          <div class="form-check">
            {{ form.active }}
            <label class="form-check-label" for="{{ form.active.id_for_label }}">Active</label>
          </div>
          {% if form.active.errors %}<div class="text-danger small ms-2">{{ form.active.errors }}</div>{% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Buttons -->
  <div class="mt-3">
    <button class="btn btn-primary">Save</button>
    <a class="btn btn-secondary" href="{% url 'academic_core:class_list' %}">Cancel</a>
  </div>
</form>

<!-- JS: auto next class id (naive increment) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const last = "{{ last_class_id|default:'' }}";
  const idInput = document.getElementById('id_class_id');
  const AUTO_NEXT = true; // set false if you don't want auto-fill

  if (AUTO_NEXT && last && idInput && !idInput.value) {
    // match trailing number: prefix + number
    const m = last.match(/^([^\d]*)(\d+)$/);
    if (m) {
      const prefix = m[1] || '';
      const numStr = m[2];
      const width = numStr.length;
      const nextNum = String(parseInt(numStr, 10) + 1).padStart(width, '0');
      idInput.value = prefix + nextNum;
    } else {
      idInput.value = last + '-1';
    }
  }
});
</script>
{% endblock %}
