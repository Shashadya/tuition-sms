{% extends 'academic_core/base.html' %}
{% block title %}Subject Detail{% endblock %}

{% block content %}
<h3>{{ subject.name }} <small class="text-muted">({{ subject.subject_id }})</small></h3>
<p>{{ subject.description|linebreaksbr }}</p>

<div class="mt-3">
  <a class="btn btn-outline-primary" href="{% url 'academic_core:subject_list' %}">Back to list</a>
  {% if request.user.is_admin or request.user.is_staff_user %}
    <a class="btn btn-sm btn-secondary" href="{% url 'academic_core:subject_update' subject.pk %}">Edit</a>
  {% endif %}
  {% if request.user.is_admin %}
    <form method="post" action="{% url 'academic_core:subject_delete' subject.pk %}" style="display:inline" onsubmit="return confirm('Delete subject {{ subject }}?');">{% csrf_token %}
      <button class="btn btn-sm btn-danger">Delete</button>
    </form>
  {% endif %}
</div>

<hr>

<h5>Assigned Teachers</h5>
{% if assignments %}
  <table class="table table-sm">
    <thead><tr><th>Assign ID</th><th>Teacher</th><th>Start</th><th>End</th><th>Actions</th></tr></thead>
    <tbody>
      {% for a in assignments %}
      <tr>
        <td>{{ a.assign_id }}</td>
        <td>{% if a.teacher %}{{ a.teacher.first_name }} {{ a.teacher.last_name }}{% else %}—{% endif %}</td>
        <td>{{ a.start_date }}</td>
        <td>{{ a.end_date|default:"—" }}</td>
        <td>
          {% if request.user.is_admin or request.user.is_staff_user %}
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'academic_core:subjectassign_update' a.pk %}">Edit</a>
          {% endif %}
          {% if request.user.is_admin %}
            <form method="post" action="{% url 'academic_core:subjectassign_delete' a.pk %}" style="display:inline" onsubmit="return confirm('Delete assignment {{ a.assign_id }}?');">{% csrf_token %}
              <button class="btn btn-sm btn-danger">Delete</button>
            </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p><em>No teachers assigned to this subject.</em></p>
{% endif %}
{% endblock %}
