{% extends 'academic_core/base.html' %}
{% block title %}Teachers{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Teachers</h3>
  {% if request.user.is_admin or request.user.is_staff_user %}
    <a class="btn btn-primary" href="{% url 'academic_core:teacher_create' %}">Add Teacher</a>
  {% endif %}
</div>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Active</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for t in teachers %}
      <tr>
        <td><a href="{% url 'academic_core:teacher_detail' t.pk %}">{{ t.title }} {{ t.first_name }} {{ t.last_name }}</a></td>
        <td>{{ t.email|default:"—" }}</td>
        <td>{{ t.phone|default:"—" }}</td>
        <td>{% if t.is_active %}Yes{% else %}No{% endif %}</td>
        <td>
          {% if request.user.is_admin or request.user.is_staff_user %}
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'academic_core:teacher_update' t.pk %}">Edit</a>
          {% endif %}

          {% if request.user.is_admin %}
            {# compute a safe display name and escape for JS #}
            {% if t.get_full_name %}
              {% with disp_name=t.get_full_name %}
                <form method="post" action="{% url 'academic_core:teacher_delete' t.pk %}"
                      style="display:inline"
                      onsubmit="return confirm('Delete teacher {{ disp_name|escapejs }} ?');">
                  {% csrf_token %}
                  <button class="btn btn-sm btn-danger" type="submit">Delete</button>
                </form>
              {% endwith %}
            {% elif t.username %}
              {% with disp_name=t.username %}
                <form method="post" action="{% url 'academic_core:teacher_delete' t.pk %}"
                      style="display:inline"
                      onsubmit="return confirm('Delete teacher {{ disp_name|escapejs }} ?');">
                  {% csrf_token %}
                  <button class="btn btn-sm btn-danger" type="submit">Delete</button>
                </form>
              {% endwith %}
            {% else %}
              {% with disp_name=t.first_name %}
                <form method="post" action="{% url 'academic_core:teacher_delete' t.pk %}"
                      style="display:inline"
                      onsubmit="return confirm('Delete teacher {{ disp_name|escapejs }} ?');">
                  {% csrf_token %}
                  <button class="btn btn-sm btn-danger" type="submit">Delete</button>
                </form>
              {% endwith %}
            {% endif %}
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="5">No teachers found.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
